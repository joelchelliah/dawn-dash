name: Keep Supabase Alive

on:
  schedule:
    # Run every other day at 2 AM UTC
    - cron: '0 2 */2 * *'
  workflow_dispatch: # Allow manual triggering

jobs:
  ping-supabase:
    runs-on: ubuntu-latest

    steps:
      - name: Ping Supabase Database
        run: |
          # Query the Talents table to keep the database alive
          API_URL="${SUPABASE_URL}/rest/v1/Talents?select=id&limit=1"

          echo "Pinging Supabase database: $API_URL"

          curl -X GET "$API_URL" \
            -H "apikey: $SUPABASE_ANON_KEY" \
            -H "Authorization: Bearer $SUPABASE_ANON_KEY" \
            -H "Content-Type: application/json" \
            --max-time 30 \
            --retry 3 \
            --retry-delay 5 \
            --silent \
            --show-error || echo "Request completed (response code may vary)"

          echo "Supabase ping completed"

        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
